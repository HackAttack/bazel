---
tasks:
  macos:
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--apple_platform_type=macos"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--test_timeout=1200"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    test_targets:
    - "--"
    - "//src/test/shell/bazel:cpp_darwin_integration_test"
  macos_xcode_10_1:
    platform: macos
    xcode_version: 10.1
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--apple_platform_type=macos"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--test_timeout=1200"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    test_targets:
    - "--"
    - "//src/test/shell/bazel:cpp_darwin_integration_test"
  macos_xcode_10_2:
    platform: macos
    xcode_version: 10.2
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--apple_platform_type=macos"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--test_timeout=1200"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    test_targets:
    - "--"
    - "//src/test/shell/bazel:cpp_darwin_integration_test"
  macos_xcode_10_3:
    platform: macos
    xcode_version: 10.3
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--apple_platform_type=macos"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--test_timeout=1200"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    test_targets:
    - "--"
    - "//src/test/shell/bazel:cpp_darwin_integration_test"
  macos_xcode_invalid:
    platform: macos
    xcode_version: not a version
    shell_commands:
    - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
      android_ndk_repository/android_ndk_repository/' WORKSPACE
    - rm -f WORKSPACE.bak
    build_flags:
    - "--apple_platform_type=macos"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    build_targets:
    - "//src:bazel"
    - "//src:bazel_jdk_minimal"
    test_flags:
    - "--test_timeout=1200"
    # Remove when https://github.com/bazelbuild/bazel/issues/7026 is fixed.
    - "--noincompatible_strict_action_env"
    test_targets:
    - "--"
    - "//src/test/shell/bazel:cpp_darwin_integration_test"
